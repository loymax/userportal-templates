<div loader="inProgress">
    <div ng-if="!inProgress">
        <div class="modal-header">
            <h2>{{:: offer.title}}</h2>
        </div>

        <div class="modal-body">
            <div class="image">
                <img ng-src="{{::offer.imgUrl}}"
                     fallback-image
                     fallback-title="{{'imageNotFound' | translate}}"
                     alt="">

                <div class="reward-thumbnail" ng-if=":: offer.rewardThumbnail" ng-switch="rewardThumbnailTypes[offer.rewardThumbnail.$type]">
                    <div class="thumbnail two-line-text" ng-switch-when="twoLineText">
                        <div title="{{::offer.rewardThumbnail.firstLine}}" class="first-line">{{::offer.rewardThumbnail.firstLine}}</div>
                        <div title="{{::offer.rewardThumbnail.secondLine}}" class="second-line">{{::offer.rewardThumbnail.secondLine}}</div>
                    </div>
                    <div class="thumbnail image-with-text" ng-switch-when="imageWithText">
                        <div title="{{::offer.rewardThumbnail.header}}">{{::offer.rewardThumbnail.header}}</div>
                        <div class="reward-image">
                            <img ng-src="{{::offer.rewardThumbnail.imgUrl || 'undefined'}}"
                                 fallback-image
                                 fallback-title="{{'imageNotFound' | translate}}"
                                 alt="">
                        </div>
                        <div title="{{::offer.rewardThumbnail.footer}}">{{::offer.rewardThumbnail.footer}}</div>
                    </div>
                    <div class="thumbnail old-new-price" ng-switch-when="oldNewPrice">
                        <div title="{{::offer.rewardThumbnail.oldPrice}}" class="old-price">{{::offer.rewardThumbnail.oldPrice}}</div>
                        <div title="{{::offer.rewardThumbnail.newPrice}}" class="new-price">{{::offer.rewardThumbnail.newPrice}}</div>
                    </div>
                </div>
            </div>
            <div class="details">
                <div>
                    <div class="offer-title">{{'offers.date' | translate}}:</div>
                    <div>{{:: (offer.begin | toUTC) | dateRange: (offer.end | toUTC)}}</div>
                </div>

                <section ng-if=":: offer.description">
                    <div class="offer-title">{{'offers.description' | translate}}:</div>
                    <div>{{:: offer.description}}</div>
                </section>

                <section ng-if=":: offer.instructions.length">
                    <div class="offer-title">{{'offers.instructions' | translate}}:</div>
                    <ol>
                        <li ng-repeat="item in offer.instructions track by $index">{{::item }}</li>
                    </ol>
                </section>

                <section ng-if=":: offer.merchants.length" ng-init="merchantsLimit = (offer.merchants.length === 4 ? 4 : 3)">
                    <div class="offer-title">{{'offers.merchants' | translate}}:</div>
                    <ul>
                        <li ng-repeat="merchant in offer.merchants | limitTo: merchantsLimit track by merchant.id">
                            {{:: merchant.title}}{{:: merchant.location ? (', ' + merchant.location.description) : ''}}
                        </li>
                    </ul>
                    <a
                        class="pseudolink"
                        ng-if="merchantsLimit !== offer.merchants.length && offer.merchants.length > 4"
                        ng-click="$parent.merchantsLimit = offer.merchants.length"
                    >
                        <span ng-if="merchantsCountText">{{'offers.showAllMerchants' | translate}} <span ng-bind-html="merchantsCountText"></span></span>
                    </a>
                    <a
                        class="pseudolink"
                        ng-if="merchantsLimit === offer.merchants.length && offer.merchants.length > 4"
                        ng-click="$parent.merchantsLimit = 3"
                    >
                        {{'offers.hideMerchants' | translate}}
                    </a>
                </section>
            </div>
        </div>
    </div>
</div>
